<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renk YÃ¶netimi - Rota 34 Admin</title>
    <link rel="stylesheet" href="admin.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="admin-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span>ğŸ¯</span>
                    <h2>Rota 34 Admin</h2>
                </div>
                <div class="user-info">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div>
                        <strong>Admin</strong>
                        <p style="font-size: 0.85rem; opacity: 0.7;">YÃ¶netici</p>
                    </div>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <span>ğŸ“Š</span> Dashboard
                </a>
                <a href="colors.html" class="menu-item active">
                    <span>ğŸ¨</span> Renkler & Tema
                </a>
                <a href="logo.html" class="menu-item">
                    <span>ğŸ–¼ï¸</span> Logo YÃ¶netimi
                </a>
                <a href="homepage.html" class="menu-item">
                    <span>ğŸ </span> Ana Sayfa
                </a>
                <a href="features-management.html" class="menu-item">
                    <span>â­</span> Ã–zellikler
                </a>
                <a href="contact-page.html" class="menu-item">
                    <span>ğŸ“</span> Ä°letiÅŸim SayfasÄ±
                </a>
                <a href="footer-settings.html" class="menu-item">
                    <span>ğŸ“„</span> Footer AyarlarÄ±
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <h1>ğŸ¨ Renkler & Tema</h1>
                <button class="btn-logout" onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>

            <div id="successMsg" class="success-msg" style="display: none;"></div>
            <div id="loadingMsg" class="success-msg" style="display: none; background: #fff3cd; color: #856404;">â³ YÃ¼kleniyor...</div>

            <div class="card">
                <h2 class="card-title">ğŸ¨ Ana Renk Paleti</h2>
                <p style="color: #666; margin-bottom: 2rem;">
                    Sitenizin temel renklerini buradan deÄŸiÅŸtirebilirsiniz. 
                    DeÄŸiÅŸiklikler anÄ±nda uygulanÄ±r.
                </p>

                <div class="grid-2">
                    <div class="form-group">
                        <label>ğŸ”´ Ana Renk (Primary)</label>
                        <div class="color-preview">
                            <input type="color" id="primaryColor" value="#FF6B35">
                            <input type="text" id="primaryText" value="#FF6B35" 
                                   style="flex: 1;" placeholder="#FF6B35">
                        </div>
                        <small style="color: #999;">Butonlar, baÅŸlÄ±klar ve vurgular iÃ§in</small>
                    </div>

                    <div class="form-group">
                        <label>ğŸ”µ Ä°kincil Renk (Secondary)</label>
                        <div class="color-preview">
                            <input type="color" id="secondaryColor" value="#0F2027">
                            <input type="text" id="secondaryText" value="#0F2027" 
                                   style="flex: 1;" placeholder="#0F2027">
                        </div>
                        <small style="color: #999;">Koyu arka planlar ve metinler iÃ§in</small>
                    </div>

                    <div class="form-group">
                        <label>ğŸŸ  Vurgu Rengi (Accent)</label>
                        <div class="color-preview">
                            <input type="color" id="accentColor" value="#F77F00">
                            <input type="text" id="accentText" value="#F77F00" 
                                   style="flex: 1;" placeholder="#F77F00">
                        </div>
                        <small style="color: #999;">Hover efektleri ve gradient'ler iÃ§in</small>
                    </div>

                    <div class="form-group">
                        <label>âš« Koyu Renk (Dark)</label>
                        <div class="color-preview">
                            <input type="color" id="darkColor" value="#1A1A2E">
                            <input type="text" id="darkText" value="#1A1A2E" 
                                   style="flex: 1;" placeholder="#1A1A2E">
                        </div>
                        <small style="color: #999;">Metin ve footer iÃ§in</small>
                    </div>
                </div>

                <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                    <button class="btn btn-primary" onclick="saveColors()">
                        ğŸ’¾ Renkleri Kaydet
                    </button>
                    <button class="btn btn-danger" onclick="resetColors()">
                        ğŸ”„ VarsayÄ±lana DÃ¶n
                    </button>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">ğŸ‘ï¸ Ã–nizleme</h2>
                <div style="padding: 2rem; background: #f8f9fa; border-radius: 10px;">
                    <button class="btn btn-primary" style="margin-right: 1rem;">
                        Ã–rnek Buton
                    </button>
                    <p style="margin-top: 1rem; color: var(--dark);">
                        Bu metin koyu renkle gÃ¶steriliyor.
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script src="admin.js"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://zyjtcywneublnmssiqhm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5anRjeXduZXVibG5tc3NpcWhtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NzcxODEzOSwiZXhwIjoyMDgzMjk0MTM5fQ.FGbUjKbRsd0GQXeJD6-MM6VfVsFGt2CHDrjwiKE8EYA';
        
        let supabaseClient;

        // Sayfa yÃ¼klendiÄŸinde
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('Renk yÃ¶netimi yÃ¼klendi');
            
            // Supabase baÅŸlat
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            console.log('âœ… Supabase baÄŸlandÄ±');
            
            // Renkleri yÃ¼kle
            await loadColors();
            
            // Renk inputlarÄ±nÄ± senkronize et
            syncColorInputs();
        });

        // Renk inputlarÄ±nÄ± senkronize et
        function syncColorInputs() {
            ['primary', 'secondary', 'accent', 'dark'].forEach(color => {
                const colorInput = document.getElementById(color + 'Color');
                const textInput = document.getElementById(color + 'Text');
                
                colorInput.addEventListener('input', (e) => {
                    textInput.value = e.target.value;
                });
                
                textInput.addEventListener('input', (e) => {
                    if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                        colorInput.value = e.target.value;
                    }
                });
            });
        }

        // Renkleri Supabase'den yÃ¼kle
        async function loadColors() {
            const loadingMsg = document.getElementById('loadingMsg');
            loadingMsg.style.display = 'block';
            
            try {
                console.log('ğŸ“¡ Renkler yÃ¼kleniyor...');
                
                const { data, error } = await supabaseClient
                    .from('site_settings')
                    .select('*')
                    .eq('key', 'colors')
                    .single();

                if (error && error.code !== 'PGRST116') {
                    throw error;
                }

                console.log('ğŸ“¦ Supabase yanÄ±tÄ±:', data);

                if (data && data.value) {
                    const colors = data.value;
                    document.getElementById('primaryColor').value = colors.primary || '#FF6B35';
                    document.getElementById('primaryText').value = colors.primary || '#FF6B35';
                    document.getElementById('secondaryColor').value = colors.secondary || '#0F2027';
                    document.getElementById('secondaryText').value = colors.secondary || '#0F2027';
                    document.getElementById('accentColor').value = colors.accent || '#F77F00';
                    document.getElementById('accentText').value = colors.accent || '#F77F00';
                    document.getElementById('darkColor').value = colors.dark || '#1A1A2E';
                    document.getElementById('darkText').value = colors.dark || '#1A1A2E';
                    
                    applyColorsToPreview(colors);
                    console.log('âœ… Renkler yÃ¼klendi');
                } else {
                    console.log('âš ï¸ VarsayÄ±lan renkler kullanÄ±lÄ±yor');
                    resetToDefaults();
                }

            } catch (error) {
                console.error('âŒ Renk yÃ¼kleme hatasÄ±:', error);
                showMessage('Hata: ' + error.message, 'error');
                resetToDefaults();
            } finally {
                loadingMsg.style.display = 'none';
            }
        }

        // VarsayÄ±lan renkleri ayarla
        function resetToDefaults() {
            const defaults = {
                primary: '#FF6B35',
                secondary: '#0F2027',
                accent: '#F77F00',
                dark: '#1A1A2E'
            };
            
            document.getElementById('primaryColor').value = defaults.primary;
            document.getElementById('primaryText').value = defaults.primary;
            document.getElementById('secondaryColor').value = defaults.secondary;
            document.getElementById('secondaryText').value = defaults.secondary;
            document.getElementById('accentColor').value = defaults.accent;
            document.getElementById('accentText').value = defaults.accent;
            document.getElementById('darkColor').value = defaults.dark;
            document.getElementById('darkText').value = defaults.dark;
            
            applyColorsToPreview(defaults);
        }

        // Renkleri Ã¶nizlemeye uygula
        function applyColorsToPreview(colors) {
            document.documentElement.style.setProperty('--primary', colors.primary);
            document.documentElement.style.setProperty('--secondary', colors.secondary);
            document.documentElement.style.setProperty('--accent', colors.accent);
            document.documentElement.style.setProperty('--dark', colors.dark);
        }

        // Renkleri kaydet
        async function saveColors() {
            const colors = {
                primary: document.getElementById('primaryColor').value,
                secondary: document.getElementById('secondaryColor').value,
                accent: document.getElementById('accentColor').value,
                dark: document.getElementById('darkColor').value
            };

            const loadingMsg = document.getElementById('loadingMsg');
            loadingMsg.style.display = 'block';

            try {
                console.log('ğŸ’¾ Renkler kaydediliyor...', colors);

                const { data, error } = await supabaseClient
                    .from('site_settings')
                    .upsert({
                        key: 'colors',
                        value: colors,
                        updated_at: new Date().toISOString()
                    }, {
                        onConflict: 'key'
                    });

                if (error) {
                    throw error;
                }

                console.log('âœ… Renkler kaydedildi:', data);
                applyColorsToPreview(colors);
                showMessage('âœ… Renkler baÅŸarÄ±yla kaydedildi!', 'success');

            } catch (error) {
                console.error('âŒ Kaydetme hatasÄ±:', error);
                showMessage('âŒ Hata: ' + error.message, 'error');
            } finally {
                loadingMsg.style.display = 'none';
            }
        }

        // VarsayÄ±lan renklere dÃ¶n
        async function resetColors() {
            if (confirm('Renkleri varsayÄ±lan deÄŸerlere dÃ¶ndÃ¼rmek istediÄŸinizden emin misiniz?')) {
                resetToDefaults();
                await saveColors();
            }
        }

        // Mesaj gÃ¶ster
        function showMessage(message, type) {
            const successMsg = document.getElementById('successMsg');
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            successMsg.style.background = type === 'success' ? '#d4edda' : '#f8d7da';
            successMsg.style.color = type === 'success' ? '#155724' : '#721c24';
            
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }
    </script>

    <style>
        .color-preview {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .color-preview input[type="color"] {
            width: 60px;
            height: 45px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
        }

        .success-msg {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>